<!--
 * @Description: 
 * @Author: JA
 * @Date: 2021-11-28 16:44:18
 * @LastEditTime: 2022-09-10 19:41:46
 * @LastEditors: JA
 * @Reference: 
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>axios 发送 AJAX请求</title>
    <style>
        #btn {
            margin-top: 10px;
            display: block;
        }

        .img {
            display: block;
        }
    </style>
</head>

<body>
    <img src="../CSS/轮播图练习/assets/3.webp" alt="焦傲" width="100" height="100" class="img">
    <button id='photo'>发送请求图片</button>

    <script>
        // const arr = new ArrayBuffer(16)
        // console.log(new Int32Array(arr));
        const imgEle = document.querySelector('img')
        let decoder = new TextDecoder()
        async function* streamGenerator(stream) {
            const reader = stream.getReader()
            try {
                while (true) {
                    const { value, done } = await reader.read()
                    if (done) {
                        break
                    }
                    yield value
                }
            } finally {
                reader.releaseLock()
            }
        }
        photo.onclick = () => {

            fetch('http://47.109.34.108:8000/server', {
                //请求方法
                method: 'POST',
                headers: {
                    name: 'JAAAA'
                },
                //请求头
                body: imgEle
            }).then((res) => {
                return res.body
            }).then(async (body) => {
                for await (chunk of streamGenerator(body)) {
                    let ans = decoder.decode(chunk,{stream:true})
                    console.log(ans);
                }
            })


        }

    </script>
</body>

</html>