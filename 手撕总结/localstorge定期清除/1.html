<!--
 * @Author: JA
 * @Date: 2022-08-17 21:46:49
 * @LastEditTime: 2022-08-17 21:50:08
 * @LastEditors: JA
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        /*
 * @Author: JA
 * @Date: 2022-08-17 21:44:36
 * @LastEditTime: 2022-08-17 21:46:03
 * @LastEditors: JA
 */
        class Store {
            constructor() {

            }
            // 存储过期时间映射
            setExpireMap(key, expire) {
                const expireMap = localStorage.getItem('EXPIRE_MAP') || "{}"
                localStorage.setItem(
                    'EXPIRE_MAP',
                    JSON.stringify({
                        ...JSON.parse(expireMap),
                        [key]: expire
                    }))
            }
            setItem(key, value, expire) {
                store.setExpireMap(key, expire)
                localStorage.setItem(key, value)
            }
            getItem(key) {
                // 在取值之前先判断是否过期
                const expireMap = JSON.parse(
                    localStorage.getItem('EXPIRE_MAP') || "{}"
                )
                console.log(expireMap, 'expireMap');
                console.log(expireMap[key], Date.now(), 'expireMap[key]');
                if (expireMap[key] && expireMap[key] < Date.now()) {
                    return localStorage.getItem(key)
                } else {
                    localStorage.removeItem(key)//value字段逐渐增大 可以在此处去除对应值
                    //可以在此处把时间的localStorage也清除
                    return null
                }
            }
            // ...
        }

        //使用自己写的Store类的对象的方法进行开发  采用浏览器内存的方法，比如expire和当前时间比较来判断是否过期
        //缺点是会永远存在一个用来存储时间的localstorge，且value字段逐渐增大
        const store = new Store()
        console.log(store);
        store.setItem('k', 'v', Date.now() - 1000)
        const ans = store.getItem('k')
        console.log(ans, 'ans');


        // 或者直接重写localStorage的方法也可以
        console.log(localStorage.__proto__ === Storage.prototype);//true
        localStorage.__proto__.getItem = () => {
            console.log(1);
            return 'asd'
        }
        console.log(localStorage.getItem('person'));
    </script>
</body>

</html>